<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Personal</title>
    <meta name="description" content="Agenda para almacenar eventos, desarrollada con Python & Flask & SQL.">
    <meta name="keywords" content="Agenda, Flask, SQL, Python">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>

    <header style="margin: 20px;">
        <h1>Agenda Personal</h1>

    </header>

    <main>
        <div class="home">
            <form action="/submit" method="post">
                <div id="AddEvent" class="addEvent">
                    <h2>Agregar Nuevo Evento:</h2>
                    <h3>Titulo:</h3> <input type="text" required minlength="1" maxlength="50" class="titleInput"
                        id="eventTitle" name="eventTitle">
                    <h3>Descripcion:</h3> <input type="text " required minlength="1" maxlength="200"
                        class="descriptionInput" id="eventDescription" name="eventDescription">
                    <h3>Fecha:</h3> <input type="date" min="2018-01-01" max="2099-01-01" id="eventDate" name="eventDate"
                        required />
                    <h3>Hora:</h3> <input type="time" id="eventHour" name="eventHour" required />
                    <br><br>
                    <input type="submit" value="Agregar Evento" class="submitButton">
                </div>
            </form>

            <section id="EventSummary" class="eventSummary">
                <h2>Eventos Actuales:</h2>

                {% for event in events %}
                <div class="event">
                    <tr>
                        <div class="Titulo">
                            <td>
                                <h1>{{ event[2] }}</h1>
                            </td>
                        </div>
                        <div class="Fecha">
                            <td>{{ event[1] }}</td>
                        </div>
                        <div class="Descripcion">
                            <td>{{ event[3] }}</td>
                        </div>
                    </tr>
                    <div class="buttonDiv">
                        <div class="B1">
                            <form action="/delete" method="post" onsubmit="return confirmDelete();">
                                <input type="hidden" value="{{event[0]}}" name="eventID">
                                <button type="submit"> Eliminar Evento {{event[0]}}</button>
                            </form>
                        </div>

                        <div class="B2">
                            <button type="button" data-bs-toggle="modal" data-bs-target="#modal{{event[0]}}"
                                data-eventdatetime="{{ event[1] }}" data-eventID="{{ event[0] }}">
                                Modificar Evento
                            </button>
                        </div>

                    </div>
                    <div class="modal fade" id="modal{{event[0]}}" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Modificar Evento #{{event[0]}}</h5>
                                </div>
                                <form action="/update" method="POST">
                                    <div class="modal-body">
                                        <div id="UpdateEvent" class="UpdateEvent">
                                            <input type="hidden" value="{{event[0]}}" name="UeventID">
                                            <h3>Titulo:</h3> <input type="text" required minlength="1" maxlength="50"
                                                class="titleInput" id="UeventTitle" name="UeventTitle"
                                                value="{{event[2]}}">
                                            <h3>Descripcion:</h3> <input type="text " required minlength="1"
                                                maxlength="200" class="descriptionInput" id="UeventDescription"
                                                name="UeventDescription" value="{{event[3]}}">
                                            <h3>Fecha:</h3> <input type="date" min="2018-01-01" max="2099-01-01"
                                                id="UeventDate" name="UeventDate" required />
                                            <h3>Hora:</h3> <input type="time" id="UeventHour" name="UeventHour"
                                                required />
                                            <br><br>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <input type="submit" value="Modificar Evento" class="submitButton">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                {% endfor %}


            </section>
        </div>
    </main>



    <footer>
        <p>&copy; 2024 Carlos Garcia. All rights reserved.</p>
    </footer>
</body>

</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"></script>

<script>

    let date = new Date().toISOString().split('T')[0];
    document.getElementById('eventDate').value = date;
    document.getElementById('eventHour').value = "00:00:00";

    function confirmDelete() {
        return confirm("Are you sure you want to delete this event?");
    }

    function onlydate(datetime) {
        // Get the current date in ISO format and extract only the date part
        let date = new Date(datetime).toISOString().split('T')[0];
        return date;
    }

    function onlytime(datetime) {
        let time = new Date(datetime).toISOString().split('T')[1];
        return (time.split('.')[0]);
    }

    $('.modal').on('show.bs.modal', function (e) {
        var modal = $(this);
        var modalId = $(this).attr('id');
        var button = $(e.relatedTarget); // The button that triggered the modal
        var eventDatetime = button.data('eventdatetime'); // Get the event datetime from data-* attribute
        console.log("Por medio del modal: " + modalId);
        console.log("Event DateTime: " + eventDate);
        date = onlydate(eventDatetime);
        time = onlytime(eventDatetime);
        modal.find('input[name="UeventDate"]').val(date);
        console.log(time);
        modal.find('input[name="UeventHour"]').val(time);
    })



</script>